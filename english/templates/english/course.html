{% extends 'english/base.html' %}

{% block content %}
<div class="container my-5">
    <h1 class="fw-bold mb-3">{{ course.name }}</h1>
    <p class="text-muted mb-4">{{ course.description }}</p>

    <div class="accordion" id="accordionExample">
        {% for chapter, user_chapter in chapter_user_chapters %}
            <div class="accordion-item border-0 shadow-sm mb-3 rounded-3 {% if user_chapter and not user_chapter.is_open %}opacity-75{% endif %}">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fw-semibold {% if user_chapter and not user_chapter.is_open %}bg-light text-muted{% endif %}"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapse-{{ chapter.id }}"
                            aria-expanded="false"
                            aria-controls="collapse-{{ chapter.id }}">
                        <span class="me-2">–ì–ª–∞–≤–∞ {{ chapter.order_index }}:</span> {{ chapter.name }}
                        {% if user_chapter %}
                            {% if user_chapter.is_open %}
                                <i class="bi bi-unlock ms-2 text-success"></i>
                            {% else %}
                                <i class="bi bi-lock ms-2 text-danger"></i>
                            {% endif %}
                        {% endif %}
                    </button>
                </h2>

                <div id="collapse-{{ chapter.id }}"
                     class="accordion-collapse collapse {% if user_chapter and not user_chapter.is_open %}disabled{% endif %}"
                     data-bs-parent="#accordionExample">
                    <div class="accordion-body bg-white rounded-bottom-3">

                        <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–º -->
                        <ul class="list-group list-group-flush">
                            {% for topic in chapter.topics.all|dictsort:"order_index" %}
                                <li class="list-group-item d-flex align-items-center justify-content-between">
                                    <div>
                                        <span class="fw-semibold">{{ topic.order_index }}.</span>
                                        {% if topic.is_public %}
                                            <!-- –ü—É–±–ª–∏—á–Ω–∞—è —Ç–µ–º–∞ ‚Äî –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞ -->
                                            <a href="{% url 'topic' topic.id %}" class="text-decoration-none fw-semibold ms-1">
                                                {{ topic.name }}
                                            </a>
                                        {% elif topic.is_accessible %}
                                            <!-- –î–æ—Å—Ç—É–ø–Ω–∞—è –ø–æ —Ç–∞—Ä–∏—Ñ—É -->
                                            <a href="{% url 'topic' topic.id %}" class="text-decoration-none fw-semibold ms-1">
                                                {{ topic.name }}
                                            </a>
                                        {% else %}
                                            <!-- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞—è —Ç–µ–º–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç -->
                                            <span class="text-muted ms-1">{{ topic.name }}</span>
                                        {% endif %}
                                    </div>

                                    {% if not topic.is_public and not topic.is_accessible %}
                                        <span class="badge bg-light text-danger border ms-2">üîí –ó–∞–∫—Ä—ã—Ç–æ</span>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>

                        <!-- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ -->
                        <div class="mt-4">
                            {% if user.is_authenticated %}
                                {% if chapter.control_test_accessible %}
                                    <a href="{% url 'control_test' chapter.id %}" class="btn btn-success px-4">
                                        –ü—Ä–æ–π—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É
                                    </a>
                                {% else %}
                                    <div class="alert alert-warning mt-3 py-2 px-3 rounded-3">
                                        <i class="bi bi-lock me-2"></i>
                                        –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —Ç–∞—Ä–∏—Ñ–∞.
                                    </div>
                                {% endif %}
                            {% else %}
                                <div class="alert alert-info mt-3 py-2 px-3 rounded-3">
                                    <i class="bi bi-person-circle me-2"></i>
                                    –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É.
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock content %}
