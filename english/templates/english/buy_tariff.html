{% extends 'english/base.html' %}

{% block content %}
<div class="container my-5">
  <!-- === –ë–ª–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ === -->
  <div class="card shadow-sm border-0 rounded-4 mx-auto p-3" style="max-width: 600px;">
    <div class="card-body p-4">
      <h2 class="text-center mb-3 fw-bold text-dark">
        {% if tariff.is_free %}
          –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å
        {% else %}
          –û–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞
        {% endif %}
      </h2>
      <h4 class="text-center text-primary mb-4">{{ tariff.name }}</h4>

      <div class="text-center mb-4">
        {% if tariff.is_free %}
          <h3 class="text-success fw-bold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</h3>
          <p class="text-muted">–ù–∏–∫–∞–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</p>
        {% else %}
          <p class="fs-5">
            –°—Ç–æ–∏–º–æ—Å—Ç—å: <span class="fw-bold text-success">{{ tariff.price|floatformat:0 }} —Å—É–º</span>
          </p>
        {% endif %}
      </div>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show rounded-3" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      {% if not user_authenticated %}
        <div class="alert alert-info text-center py-2 px-3 rounded-3 mb-4 shadow-sm">
          <i class="bi bi-person-circle me-2"></i>
          {% if tariff.is_free %}
            –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ.
          {% else %}
            –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —Ç–∞—Ä–∏—Ñ.
          {% endif %}
        </div>
        <div class="text-center">
          <a href="{% url 'login' %}" class="btn btn-outline-primary rounded-3 px-4">
            –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
          </a>
        </div>
      {% else %}
        {% if tariff.is_free %}
          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∫—É—Ä—Å–∞ -->
          <div class="alert alert-success rounded-3 mb-4">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-gift me-2"></i>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
            </h5>
            <p class="mb-3">–≠—Ç–æ—Ç –∫—É—Ä—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π! –í—ã –º–æ–∂–µ—Ç–µ —Å—Ä–∞–∑—É –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ.</p>
            <ul class="mb-0">
              <li>–í—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–ª–∞–≤—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É</li>
              <li>–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –≥–ª–∞–≤—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ</li>
              <li>–ù–∞–±–∏—Ä–∞–π—Ç–µ 80%+ –≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –≥–ª–∞–≤</li>
            </ul>
          </div>
          
          <div class="text-center">
            <a href="{% url 'course_detail' tariff.course.id %}" class="btn btn-success btn-lg w-100 py-3 rounded-3 shadow-sm">
              <i class="bi bi-play-circle me-2"></i>–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
            </a>
          </div>
        {% else %}
          <!-- –§–æ—Ä–º–∞ –¥–ª—è –ø–ª–∞—Ç–Ω–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ -->
          <div class="alert alert-warning rounded-3 mb-4">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-exclamation-triangle me-2"></i>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–ø–ª–∞—Ç–µ:
            </h5>
            <ol class="mb-0">
              <li>–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ {{ tariff.price|floatformat:0 }} —Å—É–º –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</li>
              <li>–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞/–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</li>
              <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ —Ñ–æ—Ä–º–µ –Ω–∏–∂–µ</li>
              <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–ª–∞—Ç–µ–∂ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç–∞—Ä–∏—Ñ</li>
            </ol>
          </div>

          <div class="card bg-light border-0 rounded-3 p-3 mb-4">
            <h6 class="fw-bold mb-2 text-center">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</h6>
            <div class="text-center">
              <p class="mb-1"><strong>–ö–∞—Ä—Ç–∞:</strong> 8600 0000 0000 0000</p>
              <p class="mb-1"><strong>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</strong> –ò–º—è –§–∞–º–∏–ª–∏—è</p>
              <p class="mb-0"><strong>–°—É–º–º–∞:</strong> {{ tariff.price|floatformat:0 }} —Å—É–º</p>
            </div>
          </div>

          <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            {% csrf_token %}
            <div class="mb-3">
              <label for="receipt" class="form-label fw-semibold text-secondary">
                <i class="bi bi-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞
              </label>
              <input
                type="file"
                name="receipt"
                id="receipt"
                class="form-control form-control-lg rounded-3 shadow-sm"
                accept="image/*"
                required
              >
              <small class="text-muted">–ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, WebP</small>
              <div class="invalid-feedback">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.</div>
            </div>

            <button type="submit" class="btn btn-primary btn-lg w-100 py-3 rounded-3 shadow-sm">
              <i class="bi bi-send me-2"></i>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
            </button>
          </form>

          <div class="alert alert-info rounded-3 mt-3 mb-0">
            <p class="mb-0 text-center small">
              <i class="bi bi-clock me-2"></i>
              <strong>–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong> –æ–±—ã—á–Ω–æ –¥–æ 24 —á–∞—Å–æ–≤
            </p>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <!-- === –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —Ç–∞—Ä–∏—Ñ–∞–º–∏ === -->
  {% if other_tariffs %}
    <div class="text-center my-5 position-relative">
      <hr class="w-25 mx-auto opacity-50">
      <span class="position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted small">
        –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ç–∞—Ä–∏—Ñ
      </span>
    </div>
  {% endif %}

  <!-- === –î—Ä—É–≥–∏–µ —Ç–∞—Ä–∏—Ñ—ã === -->
  {% if other_tariffs %}
    <div class="row justify-content-center g-4">
      {% for t in other_tariffs %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card border-0 rounded-4 shadow-sm h-100 tariff-card" style="transition: all 0.3s ease;">
            <div class="card-body text-center p-4">
              <h5 class="fw-bold text-primary mb-2">{{ t.name }}</h5>
              {% if t.is_free %}
                <p class="fs-5 text-success fw-semibold mb-3">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
              {% else %}
                <p class="fs-5 text-success fw-semibold mb-3">{{ t.price|floatformat:0 }} —Å—É–º</p>
              {% endif %}
              <p class="text-muted small mb-4">{{ t.description|truncatechars:80 }}</p>

              {% if user_authenticated %}
                <a href="{% url 'buy_tariff' t.id %}" class="btn btn-outline-primary w-100 rounded-3 shadow-sm">
                  {% if t.is_free %}
                    üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                  {% else %}
                    üí≥ –ö—É–ø–∏—Ç—å —Ç–∞—Ä–∏—Ñ
                  {% endif %}
                </a>
              {% else %}
                <a href="{% url 'login' %}" class="btn btn-outline-secondary w-100 rounded-3 shadow-sm">
                  üîê –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
  <div class="text-center mt-4">
    <a href="{% url 'course_detail' tariff.course.id %}" class="btn btn-outline-secondary rounded-3 px-4">
      <i class="bi bi-arrow-left me-2"></i>–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—É—Ä—Å—É
    </a>
  </div>
</div>

<!-- === –°—Ç–∏–ª–∏ === -->
<style>
  .tariff-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
  }
</style>

<!-- === –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã === -->
<script>
  (function () {
    'use strict';
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();
</script>
{% endblock %}