{% extends 'english/base.html' %}
{% load static %}
{% block title %}–¢–∞—Ä–∏—Ñ: {{ tariff.name }}{% endblock %}
{% block content %}
<style>
  /* Header */
  .tariff-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px 20px 0 0;
    padding: 40px 20px;
    position: relative;
    overflow: hidden;
    color: #fff;
    text-align: center;
  }

  .tariff-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: rotate 20s linear infinite;
  }

  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .tariff-header h2 {
    font-size: 28px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 12px;
  }

  .tariff-header h4 {
    font-size: 20px;
    font-weight: 600;
    color: rgba(255,255,255,0.9);
    margin-bottom: 16px;
  }

  .tariff-header .price-info {
    font-size: 24px;
    font-weight: 600;
    color: #28a745;
    margin-bottom: 16px;
  }

  .tariff-header .price-info.free {
    font-size: 28px;
  }

  /* Breadcrumbs */
  .breadcrumb {
    background: transparent;
    padding: 0;
    margin-bottom: 20px;
  }

  .breadcrumb-item a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
  }

  .breadcrumb-item.active {
    color: #718096;
  }

  /* Alerts */
  .alert {
    border-radius: 12px;
    padding: 16px;
    font-size: 14px;
    background: #fff;
    border: 1px solid #e2e8f0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .alert h5 {
    font-size: 16px;
    font-weight: 600;
    color: #2d3748;
  }

  .alert ul {
    font-size: 14px;
    color: #718096;
  }

  /* Form */
  .form-control {
    border-radius: 12px;
    border: 2px solid #e2e8f0;
    padding: 12px;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    outline: none;
  }

  .form-label {
    font-size: 14px;
    font-weight: 500;
    color: #2d3748;
  }

  .invalid-feedback {
    font-size: 12px;
    color: #dc3545;
  }

  /* Tariff Cards */
  .tariff-card {
    border: none;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
  }

  .tariff-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
  }

  .tariff-card .card-body {
    padding: 24px;
  }

  .tariff-card h5 {
    font-size: 18px;
    font-weight: 600;
    color: #667eea;
  }

  .tariff-card .price {
    font-size: 20px;
    font-weight: 600;
    color: #28a745;
  }

  /* Divider */
  .divider {
    position: relative;
    margin: 40px 0;
  }

  .divider hr {
    border-top: 1px solid #e2e8f0;
  }

  .divider span {
    background: #fff;
    padding: 0 16px;
    font-size: 14px;
    color: #718096;
  }

  /* Buttons */
  .course-btn {
    padding: 12px 24px;
    font-size: 14px;
  }

  .btn-outline-secondary {
    border-color: #e2e8f0;
    color: #2d3748;
    padding: 12px 24px;
    font-size: 14px;
  }

  .btn-outline-secondary:hover {
    background: #f7fafc;
    border-color: #667eea;
    color: #667eea;
  }
</style>

<div class="container my-5">
  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url 'home' %}">
          üè† –ì–ª–∞–≤–Ω–∞—è
        </a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'course_detail' tariff.course.id %}">
          {{ tariff.course.name }}
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">{{ tariff.name }}</li>
    </ol>
  </nav>

  <!-- Tariff Header and Form -->
  <div class="card shadow-sm border-0" style="border-radius: 20px; overflow: hidden;">
    <div class="tariff-header">
      <h2>
        {% if tariff.is_free %}
          –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫—É—Ä—Å
        {% else %}
          –û–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞
        {% endif %}
      </h2>
      <h4>{{ tariff.name }}</h4>
      <div class="price-info {% if tariff.is_free %}free{% endif %}">
        {% if tariff.is_free %}
          –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
        {% else %}
          {{ tariff.price|floatformat:0 }} —Å—É–º
        {% endif %}
      </div>
      {% if not tariff.is_free %}
        <p class="small">–û–ø–ª–∞—Ç–∏—Ç–µ —Ç–∞—Ä–∏—Ñ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É</p>
      {% else %}
        <p class="small">–ù–∏–∫–∞–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</p>
      {% endif %}
    </div>

    <div class="card-body p-4">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      {% if not user.is_authenticated %}
        <div class="alert alert-info text-center">
          <i class="bi bi-person-circle me-2"></i>
          {% if tariff.is_free %}
            –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ.
          {% else %}
            –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —Ç–∞—Ä–∏—Ñ.
          {% endif %}
        </div>
        <div class="text-center">
          <a href="{% url 'login' %}" class="course-btn w-100">
            <i class="bi bi-box-arrow-in-right me-2"></i>–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
          </a>
        </div>
      {% else %}
        {% if tariff.is_free %}
          <!-- Free Tariff Info -->
          <div class="alert alert-success">
            <h5>
              <i class="bi bi-gift me-2"></i>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
            </h5>
            <p>–≠—Ç–æ—Ç –∫—É—Ä—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π! –í—ã –º–æ–∂–µ—Ç–µ —Å—Ä–∞–∑—É –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ.</p>
            <ul>
              <li>–í—Å–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –≥–ª–∞–≤—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É</li>
              <li>–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –≥–ª–∞–≤—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ</li>
              <li>–ù–∞–±–∏—Ä–∞–π—Ç–µ 80%+ –≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –≥–ª–∞–≤</li>
            </ul>
          </div>
          <div class="text-center">
            <a href="{% url 'course_detail' tariff.course.id %}" class="course-btn w-100">
              <i class="bi bi-play-circle me-2"></i>–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
            </a>
          </div>
        {% else %}
          <!-- Paid Tariff Form -->
          <div class="alert alert-warning">
            <h5>
              <i class="bi bi-exclamation-triangle me-2"></i>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–ø–ª–∞—Ç–µ:
            </h5>
            <ol>
              <li>–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ {{ tariff.price|floatformat:0 }} —Å—É–º –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</li>
              <li>–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞/–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</li>
              <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ —Ñ–æ—Ä–º–µ –Ω–∏–∂–µ</li>
              <li>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–ª–∞—Ç–µ–∂ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç–∞—Ä–∏—Ñ</li>
            </ol>
          </div>

          <div class="card bg-light border-0 rounded-3 p-3 mb-4">
            <h6 class="fw-bold text-center">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</h6>
            <div class="text-center">
              <p class="mb-1"><strong>–ö–∞—Ä—Ç–∞:</strong> 8600 0000 0000 0000</p>
              <p class="mb-1"><strong>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</strong> –ò–º—è –§–∞–º–∏–ª–∏—è</p>
              <p class="mb-0"><strong>–°—É–º–º–∞:</strong> {{ tariff.price|floatformat:0 }} —Å—É–º</p>
            </div>
          </div>

          <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            {% csrf_token %}
            <div class="mb-3">
              <label for="receipt" class="form-label">
                <i class="bi bi-upload me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞
              </label>
              <input
                type="file"
                name="receipt"
                id="receipt"
                class="form-control"
                accept="image/*"
                required
              >
              <small class="text-muted">–ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, WebP</small>
              <div class="invalid-feedback">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.</div>
            </div>
            <button type="submit" class="course-btn w-100">
              <i class="bi bi-send me-2"></i>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
            </button>
          </form>

          <div class="alert alert-info mt-3">
            <p class="mb-0 text-center">
              <i class="bi bi-clock me-2"></i>
              <strong>–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong> –æ–±—ã—á–Ω–æ –¥–æ 24 —á–∞—Å–æ–≤
            </p>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <!-- Divider -->
  {% if other_tariffs %}
  <div class="divider text-center">
    <hr>
    <span class="position-absolute top-50 start-50 translate-middle">–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ç–∞—Ä–∏—Ñ</span>
  </div>
  {% endif %}

  <!-- Other Tariffs -->
  {% if other_tariffs %}
  <div class="row g-4">
    {% for t in other_tariffs %}
    <div class="col-12 col-md-6 col-lg-4">
      <div class="tariff-card h-100">
        <div class="card-body text-center">
          <h5>{{ t.name }}</h5>
          <p class="price {% if t.is_free %}free{% endif %}">
            {% if t.is_free %}–ë–µ—Å–ø–ª–∞—Ç–Ω–æ{% else %}{{ t.price|floatformat:0 }} —Å—É–º{% endif %}
          </p>
          <p class="text-muted">{{ t.description|truncatechars:80 }}</p>
          {% if user.is_authenticated %}
            <a href="{% url 'buy_tariff' t.id %}" class="course-btn w-100">
              {% if t.is_free %}
                <i class="bi bi-eye me-2"></i>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
              {% else %}
                <i class="bi bi-cart me-2"></i>–ö—É–ø–∏—Ç—å —Ç–∞—Ä–∏—Ñ
              {% endif %}
            </a>
          {% else %}
            <a href="{% url 'login' %}" class="btn btn-outline-secondary w-100">
              <i class="bi bi-lock me-2"></i>–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
            </a>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Back Button -->
  <div class="text-center mt-4">
    <a href="{% url 'course_detail' tariff.course.id %}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-2"></i>–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—É—Ä—Å—É
    </a>
  </div>
</div>

<!-- Form Validation -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const forms = document.querySelectorAll(".needs-validation");
  forms.forEach(form => {
    form.addEventListener("submit", function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add("was-validated");
    }, false);
  });
});
</script>
{% endblock %}