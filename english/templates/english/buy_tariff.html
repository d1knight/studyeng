{% extends 'english/base.html' %}

{% block content %}
<div class="container my-5">

  <!-- === –ë–ª–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ —Ç–∞—Ä–∏—Ñ–∞ === -->
  <div class="card shadow-sm border-0 rounded-4 mx-auto p-3" style="max-width: 600px;">
    <div class="card-body p-4">
      <h2 class="text-center mb-3 fw-bold text-dark">–û–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞</h2>
      <h4 class="text-center text-primary mb-4">{{ tariff.name }}</h4>

      <div class="text-center mb-4">
        <p class="fs-5">
          –°—Ç–æ–∏–º–æ—Å—Ç—å: <span class="fw-bold text-success">{{ tariff.price|floatformat:0 }} —Å—É–º</span>
        </p>
      </div>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show rounded-3" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      {% if not user_authenticated %}
        <div class="alert alert-info text-center py-2 px-3 rounded-3 mb-4 shadow-sm">
          <i class="bi bi-person-circle me-2"></i>
          –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —Ç–∞—Ä–∏—Ñ.
        </div>
        <div class="text-center">
          <a href="{% url 'login' %}" class="btn btn-outline-primary rounded-3 px-4">
            –í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
          </a>
        </div>
      {% else %}
        <form method="post" enctype="multipart/form-data" class="needs-validation mt-3" novalidate>
          {% csrf_token %}
          <div class="mb-3">
            <label for="receipt" class="form-label fw-semibold text-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞</label>
            <input
              type="file"
              name="receipt"
              id="receipt"
              class="form-control form-control-lg rounded-3 shadow-sm"
              accept="image/*"
              required
            >
            <div class="invalid-feedback">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.</div>
          </div>

          <button type="submit" class="custom-btn-success w-100 py-2 fs-5 rounded-3 shadow-sm mt-3">
            <i class="bi bi-upload me-2"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫
          </button>
        </form>
      {% endif %}
    </div>
  </div>

  <!-- === –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —Ç–∞—Ä–∏—Ñ–∞–º–∏ === -->
  {% if other_tariffs %}
    <div class="text-center my-5 position-relative">
      <hr class="w-25 mx-auto opacity-50">
      <span class="position-absolute top-50 start-50 translate-middle bg-white px-3 text-muted small">
        –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ç–∞—Ä–∏—Ñ
      </span>
    </div>
  {% endif %}

  <!-- === –î—Ä—É–≥–∏–µ —Ç–∞—Ä–∏—Ñ—ã === -->
  {% if other_tariffs %}
    <div class="row justify-content-center g-4">
      {% for t in other_tariffs %}
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card border-0 rounded-4 shadow-sm h-100 tariff-card" style="transition: all 0.3s ease;">
            <div class="card-body text-center p-4">
              <h5 class="fw-bold text-primary mb-2">{{ t.name }}</h5>
              <p class="fs-5 text-success fw-semibold mb-3">{{ t.price|floatformat:0 }} —Å—É–º</p>
              <p class="text-muted small mb-4">{{ t.description|truncatechars:80 }}</p>

              {% if user_authenticated %}
                <a href="{% url 'buy_tariff' t.id %}" class="btn btn-outline-primary w-100 rounded-3 shadow-sm">
                  üí≥ –ö—É–ø–∏—Ç—å —Ç–∞—Ä–∏—Ñ
                </a>
              {% else %}
                <a href="{% url 'login' %}" class="btn btn-outline-secondary w-100 rounded-3 shadow-sm">
                  üîê –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

</div>

<!-- === –ú–∏–Ω–∏-–∞–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤ === -->
<style>
  .tariff-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
  }
</style>

<script>
  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã Bootstrap
  (function () {
    'use strict';
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();
</script>
{% endblock %}
