{% extends 'english/base.html' %}
{% load static %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}
{% block content %}
<style>
  /* Hero Section - —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è */
  .hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 40px 20px;
    position: relative;
    overflow: hidden;
    color: #fff;
  }

  .hero-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: rotate 20s linear infinite;
  }

  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .hero-content {
    z-index: 2;
    position: relative;
  }

  .hero-content h1 {
    font-size: 36px;
    font-weight: 700;
    color: #fff !important;
    margin-bottom: 16px;
  }

  .hero-content p {
    font-size: 18px;
    color: rgba(255,255,255,0.95) !important;
    margin-bottom: 24px;
  }

  .hero-badge {
    background: rgba(255,255,255,0.2);
    color: #fff !important;
    font-size: 14px;
    padding: 8px 16px;
    border-radius: 12px;
    margin-bottom: 20px;
    backdrop-filter: blur(10px);
  }

  .hero-achievements {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 24px;
    color: #fff !important;
  }

  /* Learning Process Section - –í–°–ï –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø –°–û–•–†–ê–ù–ï–ù–´ */
  .learning-process {
    background: #f7fafc;
    border-radius: 16px;
    padding: 40px 20px;
  }

  .section-title {
    font-size: 24px;
    font-weight: 700;
    color: #2d3748 !important;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-title::before {
    content: '';
    width: 4px;
    height: 24px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
  }

  .process-card {
    border: none;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .process-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
  }

  .process-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 16px 16px 0 0;
  }

  .process-card-body {
    padding: 24px;
  }

  .process-badge {
    position: absolute;
    top: 16px;
    left: 16px;
    background: rgba(255,255,255,0.9);
    color: #2d3748;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  /* Tariffs Section */
  .tariff-card {
    border: none;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .tariff-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
  }

  .tariff-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    padding: 24px;
  }

  .tariff-item {
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
    background: #fff;
  }

  .tariff-item:hover {
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
  }

  /* Comments Section */
  .comments-section {
    background: #f7fafc;
    border-radius: 16px;
    padding: 40px 20px;
  }

  .comment-carousel-item {
    padding: 20px;
  }

  .comment-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: 700;
    font-size: 20px;
    margin: 0 auto 20px;
  }

  .comment-form {
    background: #fff;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .comment-form textarea {
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 12px 16px;
    transition: all 0.3s ease;
    resize: vertical;
    min-height: 100px;
  }

  .comment-form textarea:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    outline: none;
  }

  /* –ö–∞—Ä—É—Å–µ–ª—å */
  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    background: #fff;
    border: 2px solid #667eea;
    border-radius: 50%;
    width: 40px;
    height: 40px;
  }

  .carousel-indicators button {
    background-color: #667eea;
  }
</style>

<div class="container my-5">
  <!-- Hero Section - –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Ø –°–û–•–†–ê–ù–ï–ù–û -->
  <section class="hero-section">
    <div class="row align-items-center g-4">
      <div class="col-lg-6">
        <div class="hero-content">
          <span class="hero-badge">üéì –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞</span>
          <h1>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ IELTS –∏ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–º —Ç–µ—Å—Ç–∞–º –í–£–ó–æ–≤</h1>
          <p>–ú–µ–Ω—è –∑–æ–≤—É—Ç <span class="fw-bold">–ë–∞–π—Ä–∞–º</span>, —è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 8 –ª–µ—Ç.</p>
          <div class="hero-achievements">
            <p class="mb-2">
              <i class="bi bi-check-circle-fill me-2"></i>
              –ú–æ–∏ –≤—ã–ø—É—Å–∫–Ω–∏–∫–∏ —É—á–∞—Ç—Å—è –≤ <strong>–ú–ì–£</strong>, <strong>–ù–ò–£ –í–®–≠</strong>, <strong>–ú–§–¢–ò</strong>
            </p>
            <p class="mb-0">
              <i class="bi bi-check-circle-fill me-2"></i>
              –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            </p>
          </div>
          <a href="#tariffs" class="course-btn btn-lg px-5 py-3">
            <i class="bi bi-rocket-takeoff me-2"></i>–í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å
          </a>
        </div>
      </div>
      <div class="col-lg-6 text-center">
        <img
          src="https://cdn.cpdonline.co.uk/wp-content/uploads/2023/02/24155222/Teacher-Teaching-Online.jpg"
          class="img-fluid rounded-4 shadow-lg"
          alt="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ë–∞–π—Ä–∞–º"
          style="max-height: 500px; object-fit: cover; border-radius: 16px;"
        />
      </div>
    </div>
  </section>

  <!-- Learning Process Section - –í–°–ï 3 –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø –°–û–•–†–ê–ù–ï–ù–´ -->
  <section class="learning-process my-5">
    <div class="text-center mb-5">
      <h2 class="section-title">üìö –ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–±—É—á–µ–Ω–∏–µ</h2>
      <p class="text-muted">–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É —É—á–µ–Ω–∏–∫—É</p>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="process-card position-relative">
          <img src="https://antaltalent.ru/wp-content/uploads/2023/01/tpk_prev.jpg" alt="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" />
          <span class="process-badge">–®–∞–≥ 1</span>
          <div class="process-card-body">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-clipboard-check text-primary me-2"></i>
              –ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
            </h5>
            <p class="text-muted mb-0">–û–ø—Ä–µ–¥–µ–ª–∏–º –≤–∞—à —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±—É—á–µ–Ω–∏—è.</p>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="process-card position-relative">
          <img src="https://www.unicraft.org/wp-content/uploads/2021/02/cropped-colleagues-generating-business-ideas_1098-19137.jpg" alt="–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å" />
          <span class="process-badge bg-success text-white">–®–∞–≥ 2</span>
          <div class="process-card-body">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-chat-dots text-success me-2"></i>
              –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            </h5>
            <p class="text-muted mb-0">–ü–æ–ª—É—á–∞–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –±—ã—Å—Ç—Ä–µ–µ.</p>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="process-card position-relative">
          <img src="https://shablon.klev.club/uploads/posts/2024-09/shablon-klev-club-zl8b-p-shabloni-kalendar-na-mesyats-bez-dat-1.jpg" alt="–ì—Ä–∞—Ñ–∏–∫ –∑–∞–Ω—è—Ç–∏–π" />
          <span class="process-badge bg-info text-white">–®–∞–≥ 3</span>
          <div class="process-card-body">
            <h5 class="fw-bold mb-3">
              <i class="bi bi-calendar-check text-info me-2"></i>
              –£–¥–æ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
            </h5>
            <p class="text-muted mb-0">–í—ã–±–∏—Ä–∞–π—Ç–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏–π ‚Äî –æ—Ñ–ª–∞–π–Ω –∏–ª–∏ –æ–Ω–ª–∞–π–Ω.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tariffs Section -->
  <section id="tariffs" class="my-5">
    <div class="text-center mb-5">
      <h2 class="section-title">üåü –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –∫—É—Ä—Å</h2>
      <p class="text-muted">–ì–∏–±–∫–∏–µ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è –ª—é–±—ã—Ö —Ü–µ–ª–µ–π –∏ —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏</p>
    </div>
    <div class="row g-4">
      {% for course in courses %}
      <div class="col-lg-6">
        <div class="tariff-card">
          <div class="tariff-header text-center">
            <h4 class="mb-2">{{ course.name }}</h4>
            <p class="mb-0 opacity-90">{{ course.description|truncatewords:15 }}</p>
          </div>
          <div class="p-4">
            {% if course.tariffs.all %}
              {% for tariff in course.tariffs.all %}
              <div class="tariff-item">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="fw-bold mb-1">
                      <i class="bi bi-{% if tariff.is_free %}gift text-success{% else %}tag text-primary{% endif %} me-1"></i>
                      {{ tariff.name }}
                    </h6>
                    <small class="text-muted">{{ tariff.description|truncatewords:8 }}</small>
                  </div>
                  <div class="text-end">
                    {% if tariff.is_free %}
                      <span class="badge bg-success px-3 py-2 mb-2">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                    {% else %}
                      <div class="fw-bold text-success fs-5 mb-2">{{ tariff.price|floatformat:0 }} —Å—É–º</div>
                    {% endif %}
                    <a href="{% url 'buy_tariff' tariff.id %}" class="course-btn btn-sm px-3 py-2">
                      {% if tariff.is_free %}<i class="bi bi-play-circle me-1"></i>–ù–∞—á–∞—Ç—å
                      {% else %}<i class="bi bi-cart me-1"></i>–ö—É–ø–∏—Ç—å{% endif %}
                    </a>
                  </div>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <p class="text-muted text-center">–¢–∞—Ä–∏—Ñ—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è</p>
            {% endif %}
          </div>
          <div class="p-4 pt-0">
            <a href="{% url 'course_detail' course.id %}" class="course-btn w-100">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫—É—Ä—Å–µ</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

  <!-- Comments Section -->
  <section id="comments" class="comments-section my-5">
    <div class="text-center mb-5">
      <h2 class="section-title">üí¨ –û—Ç–∑—ã–≤—ã —É—á–µ–Ω–∏–∫–æ–≤</h2>
      <p class="text-muted">–†–µ–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –æ—Ç –Ω–∞—à–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
    </div>

    {% if comments %}
    <div id="carouselComments" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">
        {% for comment in comments %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          <div class="text-center comment-carousel-item">
            <div class="comment-avatar">
              {{ comment.user.first_name.0 }}{{ comment.user.last_name.0 }}
            </div>
            <div style="max-width: 600px; margin: 0 auto;">
              <p class="lead text-dark mb-4">{{ comment.text }}</p>
              <h5 class="fw-bold mb-2">{{ comment.user.first_name }} {{ comment.user.last_name }}</h5>
              <small class="text-muted">{{ comment.created_at|date:"d.m.Y" }}</small>
              <div class="text-warning mt-3">
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselComments" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselComments" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
      <div class="carousel-indicators">
        {% for comment in comments %}
        <button type="button" data-bs-target="#carouselComments" data-bs-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %}"></button>
        {% endfor %}
      </div>
    </div>
    {% else %}
    <div class="text-center py-5">
      <i class="bi bi-chat-dots text-muted fs-1 mb-3"></i>
      <p class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
    </div>
    {% endif %}

    <!-- –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
    {% if user.is_authenticated %}
    <div class="mt-5">
      <div class="comment-form mx-auto" style="max-width: 700px;">
        <h5 class="fw-bold mb-4">üìù –û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π –æ—Ç–∑—ã–≤</h5>
        <form id="commentForm">
          {% csrf_token %}
          {{ comment_form.as_p }}
          <button type="submit" class="course-btn w-100">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        </form>
        <div id="commentMessage" class="mt-3"></div>
      </div>
    </div>
    {% endif %}
  </section>
</div>

<!-- AJAX –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
{% if user.is_authenticated %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  const form = document.getElementById("commentForm");
  if (!form) return;
  
  const messageDiv = document.getElementById("commentMessage");
  
  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    const data = new FormData(form);

    try {
      const response = await fetch("", {
        method: "POST",
        headers: { "X-Requested-With": "XMLHttpRequest" },
        body: data,
      });
      const result = await response.json();

      if (result.success) {
        messageDiv.innerHTML = '<div class="alert alert-success rounded-3">‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!</div>';
        form.reset();
        setTimeout(() => messageDiv.innerHTML = "", 3000);
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª–∏
        setTimeout(() => location.reload(), 1000);
      } else {
        messageDiv.innerHTML = `<div class="alert alert-danger rounded-3">${result.error}</div>`;
      }
    } catch (error) {
      messageDiv.innerHTML = '<div class="alert alert-danger rounded-3">–û—à–∏–±–∫–∞ —Å–µ—Ç–∏</div>';
    }
  });
});
</script>
{% endif %}

{% endblock %}