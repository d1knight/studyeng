{% extends 'english/base.html' %} 
{% block content %}

<!-- Hero -->
<section id="home" class="py-5">
  <div class="row align-items-center">
    <div class="col-md-6">
      <h1 class="fw-bold mb-4 text-dark lh-base">
        –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ IELTS –∏ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–º —Ç–µ—Å—Ç–∞–º –í–£–ó–æ–≤
      </h1>
      <p class="lead text-secondary mb-3">
        –ú–µ–Ω—è –∑–æ–≤—É—Ç <span class="fw-semibold text-primary">–ë–∞–π—Ä–∞–º</span>, —è
        –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Å –æ–ø—ã—Ç–æ–º –±–æ–ª–µ–µ 8 –ª–µ—Ç.
      </p>
      <p class="text-muted mb-4">
        –ú–æ–∏ –≤—ã–ø—É—Å–∫–Ω–∏–∫–∏ —É—á–∞—Ç—Å—è –≤ <strong>–ú–ì–£</strong>, <strong>–ù–ò–£ –í–®–≠</strong>,
        <strong>–ú–§–¢–ò</strong> –∏ –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞—Ö. –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏
        –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã –º–Ω–æ–π –ª–∏—á–Ω–æ.
      </p>
      
        href="#tarifff"
        class="btn btn-success btn-lg px-4 py-2 rounded-3 shadow-sm"
      >
        üöÄ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å
      </a>
    </div>
    <div class="col-md-6 text-center mt-4 mt-md-0">
      <img
        src="https://cdn.cpdonline.co.uk/wp-content/uploads/2023/02/24155222/Teacher-Teaching-Online.jpg"
        class="rounded-4 img-fluid shadow-lg"
        alt="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å"
      />
    </div>
  </div>
</section>

<!-- –ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–±—É—á–µ–Ω–∏–µ -->
<section class="py-5 bg-light">
  <div class="text-center mb-5">
    <h2 class="fw-bold mb-3 text-dark">–ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–±—É—á–µ–Ω–∏–µ</h2>
    <p class="text-muted">
      –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É —É—á–µ–Ω–∏–∫—É
    </p>
  </div>

  <div class="row g-4 justify-content-center">
    <div class="col-md-4">
      <div class="card h-100 shadow-sm border-0 hover-scale">
        <img
          src="https://antaltalent.ru/wp-content/uploads/2023/01/tpk_prev.jpg"
          class="card-img-top rounded-top-3"
          alt="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
        />
        <div class="card-body">
          <h5 class="card-title fw-semibold">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è</h5>
          <p class="card-text text-muted">
            –û–ø—Ä–µ–¥–µ–ª–∏–º –≤–∞—à —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω
            –æ–±—É—á–µ–Ω–∏—è.
          </p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card h-100 shadow-sm border-0 hover-scale">
        <img
          src="https://www.unicraft.org/wp-content/uploads/2021/02/cropped-colleagues-generating-business-ideas_1098-19137.jpg"
          class="card-img-top rounded-top-3"
          alt="–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å"
        />
        <div class="card-body">
          <h5 class="card-title fw-semibold">
            –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
          </h5>
          <p class="card-text text-muted">
            –ü–æ–ª—É—á–∞–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —á—Ç–æ–±—ã –¥–≤–∏–≥–∞—Ç—å—Å—è –∫
            —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –±—ã—Å—Ç—Ä–µ–µ.
          </p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card h-100 shadow-sm border-0 hover-scale">
        <img
          src="https://shablon.klev.club/uploads/posts/2024-09/shablon-klev-club-zl8b-p-shabloni-kalendar-na-mesyats-bez-dat-1.jpg"
          class="card-img-top rounded-top-3"
          alt="–ì—Ä–∞—Ñ–∏–∫ –∑–∞–Ω—è—Ç–∏–π"
        />
        <div class="card-body">
          <h5 class="card-title fw-semibold">–£–¥–æ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫</h5>
          <p class="card-text text-muted">
            –í—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏–π ‚Äî –æ—Ñ–ª–∞–π–Ω –∏–ª–∏ –æ–Ω–ª–∞–π–Ω.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- –¢–∞—Ä–∏—Ñ—ã -->
<section id="tarifff" class="py-5">
  <div class="text-center mb-5">
    <h2 class="fw-bold mb-3 text-dark">–¢–∞—Ä–∏—Ñ—ã</h2>
    <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</p>
  </div>

  <div class="row justify-content-center g-4">
    {% for course in courses %}
    <div class="col-sm-6 col-md-6 col-lg-5">
      <div class="card h-100 border-0 shadow-lg rounded-4 hover-lift">
        <div class="card-body d-flex flex-column p-4">
          <h4 class="card-title text-center fw-semibold mb-2 text-primary">
            {{ course.name }}
          </h4>
          <p class="text-center text-muted mb-4">
            {{ course.description|truncatewords:10 }}
          </p>

          <ul class="list-unstyled flex-grow-1 mb-3">
            {% for tarif in course.tariffs.all %}
            <li
              class="d-flex justify-content-between align-items-center border-bottom py-2"
            >
              <span>{{ tarif.name }}</span>
              <div>
                <span class="fw-bold text-success">{{ tarif.price }} —Å—É–º</span>
                
                  href="{% url 'buy_tariff' tarif.id %}"
                  class="btn btn-outline-success btn-sm ms-2"
                  >–ö—É–ø–∏—Ç—å</a
                >
              </div>
            </li>
            {% endfor %}
          </ul>

          
            href="{% url 'course_detail' course.id %}"
            class="btn btn-primary mt-auto w-100"
            >–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫—É—Ä—Å–µ</a
          >
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- –û—Ç–∑—ã–≤—ã -->
<section class="py-5 bg-light" id="comments">
  <div class="text-center mb-5">
    <h2 class="fw-bold text-dark mb-3">–û—Ç–∑—ã–≤—ã —É—á–µ–Ω–∏–∫–æ–≤</h2>
    <p class="text-muted">–†–µ–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –æ—Ç –Ω–∞—à–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
  </div>

  {% if comments %}
  <div id="carouselComments" class="carousel slide text-center" data-bs-ride="carousel">
    <div class="carousel-inner">
      {% for comment in comments %}
      <div
        class="carousel-item {% if forloop.first %}active{% endif %}"
        data-bs-interval="5000"
      >
        <!-- üîπ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        {% if comment.user.avatar %}
          <img
            src="{{ comment.user.avatar.url }}"
            class="d-block mx-auto rounded-circle shadow"
            alt="{{ comment.user.first_name }}"
            width="140"
            height="140"
            style="object-fit: cover;"
          />
        {% else %}
          <!-- –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –∞–≤–∞—Ç–∞—Ä -->
          <img
            src="https://ui-avatars.com/api/?name={{ comment.user.first_name }}+{{ comment.user.last_name }}&size=140&background=0D8ABC&color=fff&bold=true"
            class="d-block mx-auto rounded-circle shadow"
            alt="{{ comment.user.first_name }}"
            width="140"
            height="140"
            style="object-fit: cover;"
          />
        {% endif %}
        
        <div class="mt-3">
          <h5 class="fw-semibold text-dark">
            {{ comment.user.first_name }} {{ comment.user.last_name }}
          </h5>
          <p class="text-muted">{{ comment.text }}</p>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª—å—é -->
    <button 
      class="carousel-control-prev" 
      type="button" 
      data-bs-target="#carouselComments" 
      data-bs-slide="prev" 
      style="opacity: 0.9; width: 5%; left: -60px;"
    >
      <span 
        class="carousel-control-prev-icon" 
        aria-hidden="true" 
        style="background-image: none; width: 40px; height: 40px; background-color: #ffffff; border: 2px solid #28a745; border-radius: 50%; position: relative;"
      >
        <span 
          style="content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-135deg); width: 12px; height: 12px; border-top: 3px solid #000000; border-right: 3px solid #000000;"
        ></span>
      </span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button 
      class="carousel-control-next" 
      type="button" 
      data-bs-target="#carouselComments" 
      data-bs-slide="next" 
      style="opacity: 0.9; width: 5%; right: -60px;"
    >
      <span 
        class="carousel-control-next-icon" 
        aria-hidden="true" 
        style="background-image: none; width: 40px; height: 40px; background-color: #ffffff; border: 2px solid #28a745; border-radius: 50%; position: relative;"
      >
        <span 
          style="content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(45deg); width: 12px; height: 12px; border-top: 3px solid #000000; border-right: 3px solid #000000;"
        ></span>
      </span>
      <span class="visually-hidden">Next</span>
    </button>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
    <div class="carousel-indicators position-static mt-4">
      {% for comment in comments %}
      <button
        type="button"
        data-bs-target="#carouselComments"
        data-bs-slide-to="{{ forloop.counter0 }}"
        class="{% if forloop.first %}active{% endif %}"
        style="width: 10px; height: 10px"
      ></button>
      {% endfor %}
    </div>
  </div>
  {% else %}
  <div class="text-center text-muted">
    <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
  </div>
  {% endif %}

  <!-- üîπ –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) -->
  {% if user.is_authenticated %}
  <div class="container mt-5" style="max-width: 600px;">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title mb-3">–û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π –æ—Ç–∑—ã–≤</h5>
        <form id="commentForm">
          {% csrf_token %}
          {{ comment_form.as_p }}
          <button type="submit" class="btn btn-success w-100">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        </form>
        <div id="commentMessage" class="mt-3"></div>
      </div>
    </div>
  </div>
  {% else %}
  <div class="text-center mt-4">
    <p class="text-muted">
      <a href="{% url 'login' %}" class="btn btn-primary">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
    </p>
  </div>
  {% endif %}
</section>

<!-- AJAX –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
{% if user.is_authenticated %}
<script>
  document
    .getElementById("commentForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);
      const response = await fetch("{% url 'home' %}", {
        method: "POST",
        headers: {
          "X-Requested-With": "XMLHttpRequest",
        },
        body: data,
      });
      const result = await response.json();
      const messageDiv = document.getElementById("commentMessage");

      if (result.success) {
        messageDiv.innerHTML =
          '<div class="alert alert-success">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!</div>';

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–∞—Ä—É—Å–µ–ª—å
        const carouselInner = document.querySelector(
          "#carouselComments .carousel-inner"
        );
        const newItem = document.createElement("div");
        newItem.className = "carousel-item";
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π –∞–≤–∞—Ç–∞—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
        let avatarHTML = '';
        if (result.avatar_url) {
          // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –∞–≤–∞—Ç–∞—Ä
          avatarHTML = `<img src="${result.avatar_url}" 
                           class="d-block mx-auto rounded-circle shadow" 
                           width="140" height="140" 
                           style="object-fit: cover;"
                           alt="${result.user}">`;
        } else {
          // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –∞–≤–∞—Ç–∞—Ä —á–µ—Ä–µ–∑ UI Avatars API
          const userName = encodeURIComponent(result.user);
          avatarHTML = `<img src="https://ui-avatars.com/api/?name=${userName}&size=140&background=0D8ABC&color=fff&bold=true" 
                           class="d-block mx-auto rounded-circle shadow" 
                           width="140" height="140" 
                           style="object-fit: cover;"
                           alt="${result.user}">`;
        }
        
        newItem.innerHTML = `
            ${avatarHTML}
            <div class="mt-3">
                <h5 class="fw-semibold text-dark">${result.user}</h5>
                <p class="text-muted">${result.text}</p>
            </div>
        `;
        carouselInner.appendChild(newItem);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        const indicators = document.querySelector(".carousel-indicators");
        const newIndicator = document.createElement("button");
        newIndicator.type = "button";
        newIndicator.setAttribute("data-bs-target", "#carouselComments");
        newIndicator.setAttribute("data-bs-slide-to", carouselInner.children.length - 1);
        newIndicator.style.width = "10px";
        newIndicator.style.height = "10px";
        indicators.appendChild(newIndicator);

        form.reset();
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          messageDiv.innerHTML = '';
        }, 3000);
      } else {
        messageDiv.innerHTML =
          '<div class="alert alert-danger">' + result.error + "</div>";
      }
    });
</script>
{% endif %}

{% endblock content %}